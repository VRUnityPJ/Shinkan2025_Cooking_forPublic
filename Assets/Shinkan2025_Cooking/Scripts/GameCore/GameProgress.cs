using System.Collections;
using System.Collections.Generic;
using Shinkan2025_Cooking.Scripts.Timer;
using UnityEngine;
using UniRx;
using VContainer;
using VContainer.Unity;

/// <summary>
/// ?Q?[???i?s???????????N???X?B???????V?[?????s?????????o???B
/// </summary>
public class GameProgress : MonoBehaviour
{
    [SerializeField] StageTimer _stageTimer;
    [SerializeField] SceneSwitch _sceneSwitch;

    private IGameEndIndicatable _gameEndIndicatable;

    [Inject]
    public void Inject(IGameEndIndicatable gameEndIndicatable)
    {
        _gameEndIndicatable = gameEndIndicatable;
    }
    /// <summary>
    /// ?V?[?????s???????????????o??????
    /// ?e?N???X???????????????????s??
    /// </summary>

    [ContextMenu("GameStart")]
    public void SetUpGameProgress()
    {
        Debug.Log("?Q?[???J?n");
        _stageTimer.StartTimer();
        Debug.Log($"{_gameEndIndicatable}です");
        //?Q?[???I???????m???w???????Q?[???I?????????????o??
        if (_gameEndIndicatable == null)
        {
            Debug.Log("IGameEndIndicatableがnullです");
            return;
        }

        _gameEndIndicatable.OnGameEnd
            .Subscribe(_ =>
            {
                ExitGame();

            }).AddTo(this);
    }

    /// <summary>
    /// ?Q?[???I???????????o??????
    /// </summary>
    public void ExitGame()
    {
        Debug.Log("????Scene?");
        _sceneSwitch.SwitchScene();
    }
}
